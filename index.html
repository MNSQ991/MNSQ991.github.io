<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>ğŸ è´ªåƒè›‡</title>
  <meta name="description" content="ä¸€ä¸ªå¯ç¦»çº¿ã€å¯å®‰è£…ã€å¸¦æœ€é«˜åˆ†è®°å½•çš„è´ªåƒè›‡æ¸¸æˆ">

  <!-- PWA å…ƒæ•°æ® -->
  <meta name="theme-color" content="#111">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- å†…è” manifest.json -->
  <script type="application/ld+json">
  {
    "name": "è´ªåƒè›‡æ¸¸æˆ",
    "short_name": "è´ªåƒè›‡",
    "description": "ç»å…¸è´ªåƒè›‡ï¼Œå•æ–‡ä»¶è¿è¡Œ",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#111",
    "theme_color": "#0074D9",
    "icons": [
      {
        "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%23111'/><text x='50%25' y='50%25' dominant-baseline='central' text-anchor='middle' font-size='120' fill='%230f0'>ğŸ</text></svg>",
        "sizes": "192x192",
        "type": "image/svg+xml"
      }
    ]
  }
  </script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f0f0f0;
      text-align: center;
      padding: 10px;
      color: #333;
    }
    h1 {
      color: #0074D9;
      margin: 15px 0;
    }
    #game-container {
      margin: 20px auto;
      position: relative;
      width: min(95vw, 400px);
      height: min(95vw, 400px);
      border: 8px solid #333;
      background: #111;
      border-radius: 8px;
      overflow: hidden;
    }
    .snake {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #0f0;
      border-radius: 4px;
    }
    .snake:first-child {
      background: #0f8;
      box-shadow: 0 0 6px rgba(0,255,128,0.8);
    }
    .food {
      position: absolute;
      width: 20px;
      height: 20px;
      background: red;
      border-radius: 50%;
      box-shadow: 0 0 8px yellow;
    }
    #score {
      font-size: 18px;
      margin: 10px;
    }

    /* è™šæ‹Ÿæ–¹å‘é”®å¸ƒå±€ */
    .controls {
      display: grid;
      grid-template-rows: repeat(3, 1fr);
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      width: 180px;
      height: 180px;
      margin: 20px auto;
    }
    .ctrl-btn {
      background: #0074D9;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 24px;
      cursor: pointer;
      user-select: none;
    }
    .ctrl-btn:active { background: #0056a3; }
    .ctrl-empty { visibility: hidden; }

    .footer {
      margin-top: 20px;
      color: #666;
      font-size: 0.9em;
    }
    .footer a {
      color: #0074D9;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>ğŸ® è´ªåƒè›‡</h1>
  <div id="score">å¾—åˆ†ï¼š0 | ğŸ† æœ€é«˜ï¼š0</div>
  <div id="game-container"></div>

  <!-- è™šæ‹Ÿæ–¹å‘é”® -->
  <div class="controls">
    <div class="ctrl-empty"></div>
    <button class="ctrl-btn" onclick="setDir('up')">â¬†ï¸</button>
    <div class="ctrl-empty"></div>
    <button class="ctrl-btn" onclick="setDir('left')">â¬…ï¸</button>
    <div class="ctrl-empty"></div>
    <button class="ctrl-btn" onclick="setDir('right')">â¡ï¸</button>
    <div class="ctrl-empty"></div>
    <button class="ctrl-btn" onclick="setDir('down')">â¬‡ï¸</button>
    <div class="ctrl-empty"></div>
  </div>

  <button onclick="startGame()" style="padding:12px 24px;font-size:16px;">â–¶ï¸ å¼€å§‹æ¸¸æˆ</button>

  <div class="footer">
    <a href="blog.html">â¬…ï¸ å›åšå®¢ä¸»é¡µ</a> | æ‰“å¼€æ‰‹æœºæµè§ˆå™¨ â†’ åˆ†äº« â†’ â€œæ·»åŠ åˆ°ä¸»å±å¹•â€ å³å¯å®‰è£…ï¼
  </div>

  <script>
    // æ¸¸æˆé…ç½®
    const container = document.getElementById("game-container");
    const scoreDisplay = document.getElementById("score");
    const width = 400;
    const cellSize = 20;
    const cols = width / cellSize;
    const rows = width / cellSize;

    let snake = [];
    let food = {};
    let direction = "right";
    let nextDirection = "right";
    let score = 0;
    let gameInterval;
    let gameRunning = false;
    let highScore = parseInt(localStorage.getItem('snakeHighScore') || '0');
    updateScore();

    function updateScore() {
      scoreDisplay.textContent = `å¾—åˆ†ï¼š${score} | ğŸ† æœ€é«˜ï¼š${highScore}`;
    }

    function initGame() {
      container.innerHTML = "";
      snake = [{ x: 10, y: 10 }];
      direction = "right";
      nextDirection = "right";
      score = 0;
      gameRunning = true;
      createFood();
      drawSnake();
      updateScore();
    }

    function drawSnake() {
      document.querySelectorAll(".snake, .food").forEach(el => el.remove());

      snake.forEach((part, index) => {
        const el = document.createElement("div");
        el.className = "snake";
        el.style.left = part.x * cellSize + "px";
        el.style.top = part.y * cellSize + "px";
        container.appendChild(el);
      });

      const foodEl = document.createElement("div");
      foodEl.className = "food";
      foodEl.style.left = food.x * cellSize + "px";
      foodEl.style.top = food.y * cellSize + "px";
      container.appendChild(foodEl);
    }

    function createFood() {
      food = {
        x: Math.floor(Math.random() * cols),
        y: Math.floor(Math.random() * rows)
      };
      if (snake.some(part => part.x === food.x && part.y === food.y)) {
        return createFood();
      }
    }

    function moveSnake() {
      direction = nextDirection;
      const head = { ...snake[0] };

      switch (direction) {
        case "up": head.y--; break;
        case "down": head.y++; break;
        case "left": head.x--; break;
        case "right": head.x++; break;
      }

      // æ’å¢™
      if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows) {
        gameOver();
        return;
      }

      // æ’è‡ªå·±
      if (snake.some((part, i) => i > 0 && part.x === head.x && part.y === head.y)) {
        gameOver();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score += 10;
        updateScore();
        createFood();
      } else {
        snake.pop();
      }

      drawSnake();
    }

    function gameOver() {
      clearInterval(gameInterval);
      gameRunning = false;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('snakeHighScore', highScore);
        updateScore();
        alert(`ğŸ‰ æ–°çºªå½•ï¼${score} åˆ†ï¼`);
      } else {
        alert(`ğŸ’¥ æ¸¸æˆç»“æŸï¼ä½ å¾—äº† ${score} åˆ†`);
      }
    }

    function startGame() {
      if (gameRunning) return;
      initGame();
      clearInterval(gameInterval);
      gameInterval = setInterval(moveSnake, 150);
    }

    // è®¾ç½®æ–¹å‘ï¼ˆè™šæ‹ŸæŒ‰é”®ç”¨ï¼‰
    window.setDir = (dir) => {
      const opp = { up: 'down', down: 'up', left: 'right', right: 'left' };
      if (direction !== opp[dir]) nextDirection = dir;
    };

    // é”®ç›˜æ§åˆ¶
    document.addEventListener("keydown", (e) => {
      switch (e.key) {
        case "ArrowUp": if (direction !== "down") nextDirection = "up"; e.preventDefault(); break;
        case "ArrowDown": if (direction !== "up") nextDirection = "down"; e.preventDefault(); break;
        case "ArrowLeft": if (direction !== "right") nextDirection = "left"; e.preventDefault(); break;
        case "ArrowRight": if (direction !== "left") nextDirection = "right"; e.preventDefault(); break;
      }
    });

    // æ³¨å†Œ Service Workerï¼ˆå†…è”ï¼Œå®ç°ç¦»çº¿è¿è¡Œï¼‰
    const swScript = `
      self.addEventListener('install', e => {
        e.waitUntil(caches.open('snake-game-v1').then(cache => cache.addAll(['/'])));
      });
      self.addEventListener('fetch', e => {
        e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
      });
    `;

    if ('serviceWorker' in navigator) {
      const blob = new Blob([swScript], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      window.addEventListener('load', () => {
        navigator.serviceWorker.register(swUrl).then(() => {
          console.log('Service Worker å·²æ³¨å†Œï¼Œæ”¯æŒç¦»çº¿è¿è¡Œï¼');
        }).catch(err => {
          console.log('SW æ³¨å†Œå¤±è´¥:', err);
        });
      });
    }

    // åˆå§‹æç¤º
    setTimeout(() => {
      alert("ğŸ® æ¬¢è¿æ¥åˆ°è´ªåƒè›‡ï¼\nä½¿ç”¨æ–¹å‘é”®æˆ–ä¸‹æ–¹è™šæ‹ŸæŒ‰é”®æ§åˆ¶\nç‚¹å‡»ã€å¼€å§‹æ¸¸æˆã€‘å¯åŠ¨ï½");
    }, 600);
  </script>
</body>
</html>
