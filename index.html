<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>ğŸ® å¤šæ¸¸æˆå¤§å… v2.0</title>
  <meta name="description" content="è´ªåƒè›‡ | äº”å­æ£‹AI | çŸ³å¤´å‰ªåˆ€å¸ƒ">

  <!-- PWA & ç»Ÿè®¡ -->
  <meta name="theme-color" content="#111">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
          data-cf-beacon='{"token": "ce8176d5e3c44c9a8b20d9f0e5d6a7b8"}'></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f0f0f0;
      text-align: center;
      padding: 10px;
      color: #333;
    }
    h1 { color: #0074D9; margin: 20px 0; }

    /* ä¸»èœå•ç½‘æ ¼ */
    .menu-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 800px;
      margin: 20px auto;
    }
    .menu-btn {
      height: 150px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .menu-btn:hover { transform: scale(1.05); }
    .menu-btn:active { transform: scale(0.98); }

    #snake-btn { background: linear-gradient(135deg, #0074D9, #0056a3); }
    #gobang-btn { background: linear-gradient(135deg, #393, #262); }
    #rps-btn { background: linear-gradient(135deg, #D94F00, #a04000); }
    #guess-btn { background: linear-gradient(135deg, #D9534F, #a0302a); }

    /* æ¸¸æˆå®¹å™¨ï¼ˆè¦†ç›–å¼ï¼‰ */
    .game-container {
      display: none;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .game-header h2 {
      color: #0074D9;
    }
    .back-btn {
      background: #ccc;
      color: #333;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    /* è´ªåƒè›‡ */
    #snake-game {
      width: 400px; height: 400px;
      margin: 0 auto;
      border: 8px solid #333;
      background: #111;
      position: relative;
    }
    .snake-part { position: absolute; width: 20px; height: 20px; background: #0f0; border-radius: 4px; }
    .snake-part:first-child { background: #0f8; box-shadow: 0 0 6px #0f8; }
    .food { position: absolute; width: 20px; height: 20px; background: red; border-radius: 50%; }

    /* äº”å­æ£‹ */
    #gobang-board {
      width: 400px; height: 400px;
      margin: 20px auto;
      background: #e8c497;
      border: 6px solid #8b4513;
      position: relative;
    }
    .gobang-line { position: absolute; background: #333; }
    .gobang-row { height: 1px; width: 380px; top: calc((var(--y)*40px)+10px); left: 10px; }
    .gobang-col { width: 1px; height: 380px; left: calc((var(--x)*40px)+10px); top: 10px; }
    .stone { position: absolute; width: 34px; height: 34px; border-radius: 50%; transform: translateY(-50%); }
    .black { background: #111; top: calc((var(--y)*40px)+27px); left: calc((var(--x)*40px)+27px); }
    .white { background: #fff; border: 1px solid #ccc; top: calc((var(--y)*40px)+27px); left: calc((var(--x)*40px)+27px); }

    /* çŒœæ•°å­— */
    #guess-input { padding: 10px; font-size: 18px; margin: 10px; width: 150px; }
    #guess-log { text-align: left; margin: 15px auto; padding: 10px; background: #f5f5f5; border-radius: 5px; max-height: 200px; overflow-y: auto; font-size: 14px; }

    /* çŸ³å¤´å‰ªåˆ€å¸ƒ */
    .rps-btns {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }
    .rps-choice {
      font-size: 30px; cursor: pointer; padding: 10px 20px; border-radius: 10px; background: #eee; transition: 0.2s;
    }
    .rps-choice:hover { background: #ddd; transform: scale(1.1); }
    #rps-result { margin: 15px; font-size: 18px; }

    .footer {
      margin-top: 40px;
      color: #666;
      font-size: 0.9em;
    }
    .footer a {
      color: #0074D9;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>ğŸ® å¤šæ¸¸æˆå¤§å… v2.0</h1>

  <!-- ä¸»èœå• -->
  <div class="menu-grid">
    <button class="menu-btn" onclick="showGame('snake')">ğŸ è´ªåƒè›‡</button>
    <button class="menu-btn" onclick="showGame('gobang')">âš« äº”å­æ£‹</button>
    <button class="menu-btn" onclick="showGame('rps')">âœŠâœ‚ï¸ğŸ“„ çŸ³å¤´å‰ªåˆ€å¸ƒ</button>
    <button class="menu-btn" onclick="showGame('guess')">ğŸ”¢ çŒœæ•°å­—</button>
  </div>

  <!-- è´ªåƒè›‡ -->
  <div id="snake-screen" class="game-container">
    <div class="game-header">
      <h2>ğŸ è´ªåƒè›‡</h2>
      <button class="back-btn" onclick="backToMenu()">è¿”å›</button>
    </div>
    <div>å¾—åˆ†ï¼š<span id="snake-score">0</span> | ğŸ† æœ€é«˜åˆ†ï¼š<span id="snake-high">0</span></div>
    <div id="snake-game"></div>
    <div style="margin: 10px;">
      <button onclick="setSnakeDir('up')">â¬†ï¸</button><br/>
      <button onclick="setSnakeDir('left')">â¬…ï¸</button>
      <button onclick="setSnakeDir('right')">â¡ï¸</button><br/>
      <button onclick="setSnakeDir('down')">â¬‡ï¸</button>
    </div>
  </div>

  <!-- äº”å­æ£‹ -->
  <div id="gobang-screen" class="game-container">
    <div class="game-header">
      <h2>âš« äº”å­æ£‹ï¼ˆäººæœºå¯¹æˆ˜ï¼‰</h2>
      <button class="back-btn" onclick="backToMenu()">è¿”å›</button>
    </div>
    <div>å½“å‰ï¼š<span id="gobang-player" style="color: #111;">ä½ ï¼ˆé»‘å­ï¼‰</span></div>
    <div id="gobang-board"></div>
    <button onclick="resetGobang()">ğŸ”„ é‡æ–°å¼€å§‹</button>
  </div>

  <!-- çŸ³å¤´å‰ªåˆ€å¸ƒ -->
  <div id="rps-screen" class="game-container">
    <div class="game-header">
      <h2>âœŠâœ‚ï¸ğŸ“„ çŸ³å¤´å‰ªåˆ€å¸ƒ</h2>
      <button class="back-btn" onclick="backToMenu()">è¿”å›</button>
    </div>
    <p>ä½ å‡ºä»€ä¹ˆï¼Ÿ</p>
    <div class="rps-btns">
      <div class="rps-choice" onclick="playRPS('rock')">âœŠ çŸ³å¤´</div>
      <div class="rps-choice" onclick="playRPS('paper')">ğŸ“„ å¸ƒ</div>
      <div class="rps-choice" onclick="playRPS('scissors')">âœ‚ï¸ å‰ªåˆ€</div>
    </div>
    <div id="rps-result">èƒœç‡ï¼š0èƒœ0è´Ÿ0å¹³</div>
    <button onclick="resetRPS()">æ¸…ç©ºè®°å½•</button>
  </div>

  <!-- çŒœæ•°å­— -->
  <div id="guess-screen" class="game-container">
    <div class="game-header">
      <h2>ğŸ”¢ çŒœæ•°å­—</h2>
      <button class="back-btn" onclick="backToMenu()">è¿”å›</button>
    </div>
    <p>æˆ‘æƒ³åˆ°ä¸€ä¸ª 1-100 çš„æ•°å­—ï¼Œä½ æ¥çŒœï¼</p>
    <input type="number" id="guess-input" min="1" max="100" />
    <button onclick="checkGuess()">æäº¤</button>
    <div id="guess-log"></div>
  </div>

  <div class="footer">
    <a href="blog.html">â¬…ï¸ å›åšå®¢ä¸»é¡µ</a> | æ”¯æŒç¦»çº¿æ¸¸ç©ï¼
  </div>

  <script>
    // ============ å…¨å±€åˆ‡æ¢ ============
    function showGame(id) {
      document.querySelectorAll('.game-container').forEach(el => el.style.display = 'none');
      document.getElementById(id + '-screen').style.display = 'block';
      if (id === 'snake') initSnake();
      if (id === 'gobang') initGobang();
      if (id === 'guess') initGuess();
      if (id === 'rps') loadRPSStats();
    }

    function backToMenu() {
      document.querySelectorAll('.game-container').forEach(el => el.style.display = 'none');
    }

    // ============ è´ªåƒè›‡ï¼ˆå¸¦æœ€é«˜åˆ†ï¼‰===========
    let snake = [], food = {}, direction = 'right', nextDir = 'right';
    let snakeScore = 0, snakeInterval;
    let snakeHighScore = parseInt(localStorage.getItem('snakeHighScore') || '0');

    function initSnake() {
      document.getElementById('snake-high').textContent = snakeHighScore;
      const game = document.getElementById('snake-game');
      game.innerHTML = '';
      snake = [{x: 10, y: 10}];
      direction = 'right'; nextDir = 'right';
      snakeScore = 0;
      document.getElementById('snake-score').textContent = 0;
      createSnakeFood();
      drawSnake();
      clearInterval(snakeInterval);
      snakeInterval = setInterval(moveSnake, 150);
    }

    function createSnakeFood() {
      food = {
        x: Math.floor(Math.random() * 20),
        y: Math.floor(Math.random() * 20)
      };
    }

    function drawSnake() {
      document.querySelectorAll('.snake-part, .food').forEach(el => el.remove());
      snake.forEach((part, i) => {
        const el = document.createElement('div');
        el.className = 'snake-part';
        el.style.left = part.x * 20 + 'px';
        el.style.top = part.y * 20 + 'px';
        document.getElementById('snake-game').appendChild(el);
      });
      const f = document.createElement('div');
      f.className = 'food';
      f.style.left = food.x * 20 + 'px';
      f.style.top = food.y * 20 + 'px';
      document.getElementById('snake-game').appendChild(f);
    }

    function moveSnake() {
      direction = nextDir;
      const head = {...snake[0]};
      switch (direction) {
        case 'up': head.y--; break;
        case 'down': head.y++; break;
        case 'left': head.x--; break;
        case 'right': head.x++; break;
      }
      if (head.x < 0 || head.x >= 20 || head.y < 0 || head.y >= 20) return gameOver();
      if (snake.some((p, i) => i > 0 && p.x === head.x && p.y === head.y)) return gameOver();
      snake.unshift(head);
      if (head.x === food.x && head.y === food.y) {
        snakeScore += 10;
        document.getElementById('snake-score').textContent = snakeScore;
        createSnakeFood();
      } else {
        snake.pop();
      }
      drawSnake();
    }

    function setSnakeDir(dir) {
      const opp = {up:'down', down:'up', left:'right', right:'left'};
      if (direction !== opp[dir]) nextDir = dir;
    }

    function gameOver() {
      clearInterval(snakeInterval);
      if (snakeScore > snakeHighScore) {
        snakeHighScore = snakeScore;
        localStorage.setItem('snakeHighScore', snakeHighScore);
        document.getElementById('snake-high').textContent = snakeHighScore;
      }
      alert(`æ¸¸æˆç»“æŸï¼å¾—åˆ†ï¼š${snakeScore}ï¼ˆæœ€é«˜ï¼š${snakeHighScore}ï¼‰`);
      backToMenu();
    }

    // ============ äº”å­æ£‹ï¼ˆAI å¯¹æˆ˜ï¼‰===========
    let gobangBoard = Array(15).fill().map(() => Array(15).fill(0));
    let gameActive = true;

    function initGobang() {
      const board = document.getElementById('gobang-board');
      board.innerHTML = '';
      for (let i = 0; i < 15; i++) {
        const row = document.createElement('div');
        row.className = 'gobang-line gobang-row';
        row.style.setProperty('--y', i);
        board.appendChild(row);
        const col = document.createElement('div');
        col.className = 'gobang-line gobang-col';
        col.style.setProperty('--x', i);
        board.appendChild(col);
      }
      gobangBoard = Array(15).fill().map(() => Array(15).fill(0));
      gameActive = true;
      board.onclick = playerMove;
    }

    function playerMove(e) {
      if (!gameActive) return;
      const rect = this.getBoundingClientRect();
      const x = Math.round((e.clientX - rect.left - 10) / 40);
      const y = Math.round((e.clientY - rect.top - 10) / 40);
      if (x < 0 || x > 14 || y < 0 || y > 14 || gobangBoard[y][x] !== 0) return;

      placeStone(x, y, 1); // 1=é»‘=ç©å®¶
      if (checkWin(x, y, 1)) {
        setTimeout(() => alert('ä½ èµ¢äº†ï¼'), 200);
        gameActive = false;
        return;
      }

      // AI å›åˆ
      setTimeout(aiMove, 500);
    }

    function placeStone(x, y, player) {
      gobangBoard[y][x] = player;
      const stone = document.createElement('div');
      stone.className = 'stone ' + (player === 1 ? 'black' : 'white');
      stone.style.setProperty('--x', x);
      stone.style.setProperty('--y', y);
      document.getElementById('gobang-board').appendChild(stone);
    }

    function aiMove() {
      if (!gameActive) return;
      // ç®€å• AIï¼šæ‰¾ç©ºä½éšæœºä¸‹ï¼ˆå¯å‡çº§ä¸ºè¯„åˆ†ç®—æ³•ï¼‰
      const empty = [];
      for (let y = 0; y < 15; y++) {
        for (let x = 0; x < 15; x++) {
          if (gobangBoard[y][x] === 0) {
            // ä¼˜å…ˆé è¿‘å·²æœ‰æ£‹å­
            if (hasNeighbor(x, y)) empty.push([x, y]);
          }
        }
      }
      const candidates = empty.length > 0 ? empty : getAllEmpty();
      const [x, y] = candidates[Math.floor(Math.random() * candidates.length)];
      placeStone(x, y, 2); // 2=ç™½=AI

      if (checkWin(x, y, 2)) {
        setTimeout(() => alert('AI èµ¢äº†ï¼'), 200);
        gameActive = false;
      }
    }

    function hasNeighbor(x, y) {
      for (let dy = -1; dy <= 1; dy++) {
        for (let dx = -1; dx <= 1; dx++) {
          if (dx === 0 && dy === 0) continue;
          if (gobangBoard[y+dy]?.[x+dx]) return true;
        }
      }
      return false;
    }

    function getAllEmpty() {
      const res = [];
      for (let y = 0; y < 15; y++) {
        for (let x = 0; x < 15; x++) {
          if (gobangBoard[y][x] === 0) res.push([x, y]);
        }
      }
      return res;
    }

    function checkWin(x, y, player) {
      const dirs = [[1,0],[0,1],[1,1],[1,-1]];
      for (let [dx, dy] of dirs) {
        let count = 1;
        for (let i = 1; i < 5; i++) {
          if (gobangBoard[y + dy*i]?.[x + dx*i] === player) count++;
          else break;
        }
        for (let i = 1; i < 5; i++) {
          if (gobangBoard[y - dy*i]?.[x - dx*i] === player) count++;
          else break;
        }
        if (count >= 5) return true;
      }
      return false;
    }

    function resetGobang() {
      initGobang();
    }

    // ============ çŒœæ•°å­— ============
    let targetNumber, guessCount, guessLog;

    function initGuess() {
      targetNumber = Math.floor(Math.random() * 100) + 1;
      guessCount = 0;
      guessLog = [];
      document.getElementById('guess-log').innerHTML = '';
    }

    function checkGuess() {
      const input = document.getElementById('guess-input');
      const guess = parseInt(input.value);
      if (isNaN(guess) || guess < 1 || guess > 100) {
        alert('è¯·è¾“å…¥ 1-100 çš„æ•°å­—ï¼');
        return;
      }
      guessCount++;
      if (guess === targetNumber) {
        const msg = `ğŸ‰ æ­å–œï¼ç­”æ¡ˆæ˜¯ ${targetNumber}ï¼Œå…±ç”¨äº† ${guessCount} æ¬¡ã€‚`;
        addLog(msg, 'green');
        setTimeout(() => {
          alert(msg);
          backToMenu();
        }, 500);
      } else if (guess > targetNumber) {
        addLog(`${guess} â€” å¤ªå¤§äº†ï¼`, 'orange');
      } else {
        addLog(`${guess} â€” å¤ªå°äº†ï¼`, 'blue');
      }
      input.value = '';
    }

    function addLog(text, color) {
      const log = document.getElementById('guess-log');
      const p = document.createElement('p');
      p.textContent = text;
      p.style.color = color;
      log.appendChild(p);
      log.scrollTop = log.scrollHeight;
    }

    // ============ çŸ³å¤´å‰ªåˆ€å¸ƒ ============
    let rpsStats = JSON.parse(localStorage.getItem('rpsStats') || '{"win":0,"lose":0,"tie":0}');

    function loadRPSStats() {
      updateRPSResult();
    }

    function playRPS(player) {
      const choices = ['rock', 'paper', 'scissors'];
      const ai = choices[Math.floor(Math.random() * 3)];
      const result = getResult(player, ai);
      if (result === 'win') rpsStats.win++;
      else if (result === 'lose') rpsStats.lose++;
      else rpsStats.tie++;
      localStorage.setItem('rpsStats', JSON.stringify(rpsStats));

      document.getElementById('rps-result').innerHTML = `
        ğŸ§‘â€ğŸ¦° ä½ ï¼š${emoji(player)} vs ğŸ¤– AIï¼š${emoji(ai)} â†’ <strong>${desc(result)}</strong><br/>
        èƒœç‡ï¼š${rpsStats.win}èƒœ ${rpsStats.lose}è´Ÿ ${rpsStats.tie}å¹³
      `;
    }

    function getResult(p, a) {
      if (p === a) return 'tie';
      if ((p === 'rock' && a === 'scissors') ||
          (p === 'paper' && a === 'rock') ||
          (p === 'scissors' && a === 'paper')) return 'win';
      return 'lose';
    }

    function emoji(choice) {
      return {rock: 'âœŠ', paper: 'ğŸ“„', scissors: 'âœ‚ï¸'}[choice];
    }

    function desc(result) {
      return {win: 'ä½ èµ¢äº†ï¼ğŸ‰', lose: 'AI èµ¢äº†ï¼ğŸ¤–', tie: 'å¹³å±€~'}[result];
    }

    function updateRPSResult() {
      document.getElementById('rps-result').textContent = `èƒœç‡ï¼š${rpsStats.win}èƒœ${rpsStats.lose}è´Ÿ${rpsStats.tie}å¹³`;
    }

    function resetRPS() {
      rpsStats = {win:0, lose:0, tie:0};
      localStorage.setItem('rpsStats', JSON.stringify(rpsStats));
      updateRPSResult();
    }

    // Service Worker
    if ('serviceWorker' in navigator) {
      const swScript = `
        self.addEventListener('install', e => e.waitUntil(caches.open('games-v2').then(cache => cache.addAll(['/'])));
        self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
      `;
      const blob = new Blob([swScript], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      window.addEventListener('load', () => navigator.serviceWorker.register(swUrl));
    }

    // æ¬¢è¿æç¤º
    setTimeout(() => {
      alert("ğŸ® æ¬¢è¿æ¥åˆ°å¤šæ¸¸æˆå¤§å…ï¼\næ‰€æœ‰æ¸¸æˆæ”¯æŒç¦»çº¿æ¸¸ç©ï¼Œæ•°æ®æœ¬åœ°ä¿å­˜ï¼");
    }, 600);
  </script>
</body>
</html>
