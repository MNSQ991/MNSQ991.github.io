<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>ğŸ è´ªåƒè›‡</title>
  <meta name="description" content="ä¸€ä¸ªå¯å®‰è£…çš„è´ªåƒè›‡æ¸¸æˆï¼Œæ— éœ€å›¾ç‰‡ï¼Œä¸€ä¸ªæ–‡ä»¶æå®šï¼">

  <!-- PWA è®¾ç½® -->
  <meta name="theme-color" content="#111">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- å†…è” manifest.json -->
  <script type="application/ld+json">
  {
    "name": "è´ªåƒè›‡æ¸¸æˆ",
    "short_name": "è´ªåƒè›‡",
    "description": "ä¸€ä¸ªç®€å•çš„è´ªåƒè›‡æ¸¸æˆ",
    "start_url": "/",
    "display": "standalone",
    "background_color": "#111",
    "theme_color": "#0074D9",
    "orientation": "portrait",
    "icons": [
      {
        "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%23111'/><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle' font-size='120' fill='%230f0'>ğŸ</text></svg>",
        "sizes": "192x192",
        "type": "image/svg+xml"
      },
      {
        "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%23111'/><text x='50%' y='50%' dominant-baseline='central' text-anchor='middle' font-size='300' fill='%230f0'>ğŸ</text></svg>",
        "sizes": "512x512",
        "type": "image/svg+xml"
      }
    ]
  }
  </script>

  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background: #f0f0f0;
      margin: 0;
      padding: 10px;
      overscroll-behavior: none;
      color: #333;
    }
    h1 {
      color: #0074D9;
      margin: 10px 0;
    }
    #game-container {
      margin: 20px auto;
      position: relative;
      width: min(90vw, 400px);
      height: min(90vw, 400px);
      max-width: 400px;
      max-height: 400px;
      border: 8px solid #333;
      background: #111;
      touch-action: none;
    }
    .snake {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #0f0;
      border-radius: 5px;
    }
    .snake:first-child {
      background: #0f0;
      box-shadow: 0 0 5px rgba(0,255,0,0.8);
    }
    .food {
      position: absolute;
      width: 20px;
      height: 20px;
      background: red;
      border-radius: 50%;
      box-shadow: 0 0 8px yellow;
    }
    #score {
      font-size: 18px;
      margin: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background: #0074D9;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    .footer {
      margin-top: 30px;
      color: #666;
      font-size: 0.9em;
    }
    .footer a {
      color: #0074D9;
      text-decoration: none;
    }
  </style>
</head>
<body>

  <h1>ğŸ® è´ªåƒè›‡</h1>
  <div id="score">å¾—åˆ†ï¼š0 | ğŸ† æœ€é«˜ï¼š0</div>
  <div id="game-container"></div>
  <button onclick="startGame()">â–¶ï¸ å¼€å§‹æ¸¸æˆ</button>

  <div class="footer">
    ğŸ“± æ‰“å¼€æ‰‹æœºæµè§ˆå™¨ â†’ åˆ†äº« â†’ â€œæ·»åŠ åˆ°ä¸»å±å¹•â€ å³å¯å®‰è£…ï¼<br>
    <a href="blog.html">â¬…ï¸ å›åšå®¢</a>
  </div>

  <script>
    // æ¸¸æˆå˜é‡
    const container = document.getElementById("game-container");
    const scoreDisplay = document.getElementById("score");
    const width = 400;
    const cellSize = 20;
    const cols = width / cellSize;
    const rows = width / cellSize;

    let snake = [];
    let food = {};
    let direction = "right";
    let nextDirection = "right";
    let score = 0;
    let gameInterval;
    let gameRunning = false;
    let highScore = parseInt(localStorage.getItem('snakeHighScore') || '0');
    updateScore();

    function updateScore() {
      scoreDisplay.textContent = `å¾—åˆ†ï¼š${score} | ğŸ† æœ€é«˜ï¼š${highScore}`;
    }

    function initGame() {
      container.innerHTML = "";
      snake = [{ x: 10, y: 10 }];
      direction = "right";
      nextDirection = "right";
      score = 0;
      gameRunning = true;
      createFood();
      drawSnake();
      updateScore();
    }

    function drawSnake() {
      document.querySelectorAll(".snake, .food").forEach(el => el.remove());

      snake.forEach((part, index) => {
        const el = document.createElement("div");
        el.classList.add("snake");
        el.style.left = part.x * cellSize + "px";
        el.style.top = part.y * cellSize + "px";
        container.appendChild(el);
      });

      const foodEl = document.createElement("div");
      foodEl.classList.add("food");
      foodEl.style.left = food.x * cellSize + "px";
      foodEl.style.top = food.y * cellSize + "px";
      container.appendChild(foodEl);
    }

    function createFood() {
      food = {
        x: Math.floor(Math.random() * cols),
        y: Math.floor(Math.random() * rows)
      };
      if (snake.some(part => part.x === food.x && part.y === food.y)) {
        return createFood();
      }
    }

    function moveSnake() {
      direction = nextDirection;
      const head = { ...snake[0] };

      switch (direction) {
        case "up": head.y--; break;
        case "down": head.y++; break;
        case "left": head.x--; break;
        case "right": head.x++; break;
      }

      // æ’å¢™
      if (head.x < 0 || head.x >= cols || head.y < 0 || head.y >= rows) {
        gameOver();
        return;
      }

      // æ’è‡ªå·±
      if (snake.some((part, i) => i > 0 && part.x === head.x && part.y === head.y)) {
        gameOver();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score += 10;
        updateScore();
        createFood();
      } else {
        snake.pop();
      }

      drawSnake();
    }

    function gameOver() {
      clearInterval(gameInterval);
      gameRunning = false;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('snakeHighScore', highScore);
        updateScore();
        alert(`ğŸ‰ æ–°çºªå½•ï¼${score} åˆ†`);
      } else {
        alert(`æ¸¸æˆç»“æŸï¼${score} åˆ†`);
      }
    }

    function startGame() {
      if (gameRunning) return;
      initGame();
      clearInterval(gameInterval);
      gameInterval = setInterval(moveSnake, 150);
    }

    // é”®ç›˜æ§åˆ¶
    document.addEventListener("keydown", (e) => {
      switch (e.key) {
        case "ArrowUp": if (direction !== "down") nextDirection = "up"; e.preventDefault(); break;
        case "ArrowDown": if (direction !== "up") nextDirection = "down"; e.preventDefault(); break;
        case "ArrowLeft": if (direction !== "right") nextDirection = "left"; e.preventDefault(); break;
        case "ArrowRight": if (direction !== "left") nextDirection = "right"; e.preventDefault(); break;
      }
    });

    // è§¦å±æ§åˆ¶ï¼ˆè™šæ‹Ÿæ–¹å‘é”®ï¼‰
    if (/Mobi|Android/i.test(navigator.userAgent)) {
      const btnStyle = "position:absolute;background:#0074D9;color:white;border:none;border-radius:8px;width:60px;height:60px;";
      const html = `
        <button onclick="handleDir('up')" style="${btnStyle}top:10px;left:50%;transform:translateX(-50%);">â¬†ï¸</button>
        <button onclick="handleDir('left')" style="${btnStyle}top:70px;left:20px;">â¬…ï¸</button>
        <button onclick="handleDir('right')" style="${btnStyle}top:70px;right:20px;">â¡ï¸</button>
        <button onclick="handleDir('down')" style="${btnStyle}top:130px;left:50%;transform:translateX(-50%);">â¬‡ï¸</button>
      `;
      const ctrl = document.createElement('div');
      ctrl.innerHTML = html;
      ctrl.style.cssText = "position:fixed;bottom:20px;width:100%;pointer-events:none;z-index:100;";
      document.body.appendChild(ctrl);

      window.handleDir = (dir) => {
        const opp = {up:'down', down:'up', left:'right', right:'left'};
        if (direction !== opp[dir]) nextDirection = dir;
      };
    }

    // æ³¨å†Œ Service Workerï¼ˆå†…è”ï¼‰
    const swScript = `
      self.addEventListener('install', e => {
        e.waitUntil(caches.open('snake-v1').then(cache => cache.addAll(['/'])));
      });
      self.addEventListener('fetch', e => {
        e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
      });
    `;

    if ('serviceWorker' in navigator) {
      const blob = new Blob([swScript], { type: 'application/javascript' });
      const swUrl = URL.createObjectURL(blob);
      window.addEventListener('load', () => {
        navigator.serviceWorker.register(swUrl).catch(err => console.log('SW æ³¨å†Œå¤±è´¥:', err));
      });
    }

    // PWA å®‰è£…æç¤º
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      setTimeout(() => {
        if (!window.matchMedia('(display-mode: standalone)').matches) {
          if (confirm('æ˜¯å¦å°†ã€è´ªåƒè›‡ã€‘æ·»åŠ åˆ°æ¡Œé¢ï¼Ÿå¯ç¦»çº¿æ¸¸ç©ï¼')) {
            deferredPrompt.prompt();
          }
        }
      }, 2000);
    });

    // åˆå§‹æç¤º
    setTimeout(() => {
      alert("ğŸ® æ¬¢è¿æ¥åˆ°è´ªåƒè›‡ï¼\nä½¿ç”¨æ–¹å‘é”®æˆ–è§¦å±æŒ‰é’®æ§åˆ¶ï¼Œç‚¹å‡»ã€å¼€å§‹æ¸¸æˆã€‘å¯åŠ¨ï½");
    }, 500);
  </script>
</body>
</html>
